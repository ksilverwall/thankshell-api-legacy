<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SLA Wallet</title>
    <link rel="shortcut icon" href="groups/sla/selan.ico" type="image/vnd.microsoft.icon">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  </head>
  <body>
    <!-- Facebook SDK -->
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '366917974106989',
          xfbml      : true,
          version    : 'v3.2'
        });
        FB.AppEvents.logPageView();
        FB.getLoginStatus(function(response) {
          if (response.status === 'connected') {
              console.log(response.authResponse.userID);

              AWS.config.region = 'ap-northeast-1';
              AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                IdentityPoolId: 'ap-northeast-1:8dc6d009-5c99-41fd-8119-e734643b2e21',
                Logins: {
                  'graph.facebook.com': response.authResponse.accessToken
                }
              });

              AWS.config.credentials.get(function(){
                let accessKeyId = AWS.config.credentials.accessKeyId;
                let secretAccessKey = AWS.config.credentials.secretAccessKey;
                let sessionToken = AWS.config.credentials.sessionToken;
                console.log('accessKeyId    : ' + accessKeyId);
                console.log('secretAccessKey: ' + secretAccessKey);
                console.log('sessionToken   : ' + sessionToken);
              });
          } else if (response.status === 'not_authorized') {
          }
        });
      };

      (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>

    <div class="container-fluid bg-info">
      <nav class="navbar row navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">SLA Wallet</a>
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="https://sketch-life-academy.com/selan-help/">ヘルプ</a>
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <label><span id='user-name'>---</span> さん</label>
          <button type="submit" id="logoutButton" class="btn btn-outline-success my-2 my-sm-0">ログアウト</button>
        </form>
      </nav>


      <div class="row">
        <div class="col-6 col-sm-2 offset-3 offset-sm-5">
          <img src="/groups/sla/selan_logo.png" class="img-fluid" alt="selan-logo">
        </div>
      </div>

      <div class="row">
        <div class="col">
          <h1 class="text-right">残高<u><span id=carried>---</span> Selan</u></h1>
        </div>
      </div>


      <div class="card mb-3">
        <div class="card-header">
          <h4>Selanを送る</h4>
        </div>
        <div class="card-body">
          <form class="form-horizontal" id="send-selan">

            <div class="row">
              <div class="col-xs-12 col-sm-6 col-md-4 form-group">
                <label>送金先</label>
                <input class="form-control" type="text" name="to_account" />
              </div>
              <div class="col-xs-12 col-sm-6 col-md-4 form-group">
                <label>金額</label>
                <input class="form-control" type="number" min="1" name="amount" value='1000'/>
              </div>
              <div class="col-xs-12 col-sm-12 col-md-4 form-group">
                <label>コメント</label>
                <input class="form-control" type="text" name="comment"/>
              </div>
            </div>

            <div class="row justify-content-around">
              <div class="col-2">
                <input id='send-selan-button' class="btn-primary" type="button" value="送金" />
              </div>
            </div>
          </form>
          <br>
          <p class="text-center text-danger" id="send-selan-message">送金後の取り消しはできませんのでご注意ください</p>
        </div>
      </div>


      <div class="card mx-auto">
        <div class="card-header">
          <h4>取引履歴</h4>
        </div>
        <div class="card-body">
          <p class="text-center text-danger" id="history-message"></p>
          <table id="transaction-list" class="table">
            <thead>
              <tr>
                <th scope="col" class="text-right">取引ID</th>
                <th scope="col">取引日時</th>
                <th scope="col">FROM</th>
                <th scope="col">TO</th>
                <th scope="col" class="text-right">金額(selan)</th>
                <th scope="col" class="text-left">コメント</th>
              </tr>
            </thead>
            <tbody id="history">
            </tbody>
          </table>
        </div>
      </div>


      <div class="row"></div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.263.1.min.js"></script>
    <script src="/js/aws-cognito-sdk.min.js"></script>
    <script src="/js/amazon-cognito-identity.min.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/bank.js"></script>

    <script>
     $(function() {
        upsample.checkSession( (err, data) => {
          if(err) {
            console.log(err);
            $(location).attr('href', '/login');
          } else {
            $("#user-name").text(data.user ? data.user : '---');
            controller.account = data.user;
            controller.session = data.session;
            controller.loadTransactions();
            $('#send-selan-button').click(function() { controller.sendSelan(); });
          }
        });
      });

      $('#logoutButton').click(upsample.logout);
    </script>
  </body>
</html>
